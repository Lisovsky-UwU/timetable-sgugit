# Бот расписания СГУГиТ
Эта программа позволяет спарсить [расписание с сайта СГУГиТ](https://sgugit.ru/raspisanie/) и предоставить его в удобном и приятном формате в виде телеграм бота.

## Функционал
Бот в телеграме позволяет просматривать расписание, автоматически выгружаемое в отдельную БД SQLite с сайта расписание. Расписание выгружается путем парсинга сайта раз в N дней. \
Пользователи, зарегестрировавшиеся в боте, получают возможность просматривать расписание для отдельных групп/преподавателей/аудиторий и добавлять нужные им расписания в избранное для быстрого доступа. 

Также для пользователей доступна обратная связь, через которую они могут отправить сообщение, которое бот перешлет в настроенную конфигурацией беседу в телеграме. В этой группе можно ответить на сообщение и тогда бот скопирует текст и отправит его в ответ на сообщение пользователя. Для пользователя это будет выглядеть, будто с ним общается бот. Этот функционал позволяет общаться с пользователями бота, оставаясь анонимным.

Софт имеет гибкую настройку через конфигурационный файл в формате INI и отдельный файл для парсинга. По умолчанию сам софт парсит расписание только по известным ему группам, дабы не перезаписывать все данные в БД каждый раз. Раз в год, во время начала учебного года, необходимо перезаписать все данные о группах в БД. Для этого достаточно выполнить команду
```
python fetcher.py --all
```
Скрипт позволяет парсить либо все разом, либо отдельными сущностями: группы, аудитории, преподаватели.

## Зависимости
Работа бота обеспечивается следующими софтами:
- [pyTelegramBotAPI](https://pypi.org/project/pyTelegramBotAPI/) - используется для работы бота;
- [SQLAlchemy](https://www.sqlalchemy.org/) - используется для управлением БД;
- [beautifulsoup4](https://pypi.org/project/beautifulsoup4/) - используется для парсинга сайта расписания;
- [loguru](https://github.com/Delgan/loguru) - используется для логгирования работы бота.

## Настройка feedback
Создайте беседу, добавьте в нее бота и вызовете команду `/start` для его запуска. Далее, посмотрите в БД в списке пользователей идентификатор группы - таблица `users`, поле `chat_id` (все chat_id начинающиеся с минуса, это беседы) и добавьте данное значение в настройки конфигруации в поле `feedback_send_to`. Перезапустите бота.

Теперь все сообщения отправленные пользователями в обратную связь будут приходить в данную беседу. \
Также вы можете указать несколько chat_id через вертикальный прочекр `|`.

## Рассылка
Вы можете выполнить рассылку всем своим пользователям бота с помощью скрипта `mailing.py`.

Напишите текст сообщения в файл `mailing_text.md` и запустите скрипт, далее все выполнится автоматически. Токен для бота будет взят из ваших текущих настроек.
